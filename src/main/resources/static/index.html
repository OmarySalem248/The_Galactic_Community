<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Colony Builder</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          margin: 20px;
          background: #fafafa;
        }

        h1 { text-align: center; }

        .panel {
          border: 1px solid #ddd;
          background: white;
          border-radius: 10px;
          padding: 15px;
          margin-bottom: 20px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
        }

        button {
          padding: 8px 12px;
          margin: 4px;
          cursor: pointer;
          border: none;
          border-radius: 5px;
          background: #1976d2;
          color: white;
          font-weight: bold;
        }

        button:hover {
          background: #135ca1;
        }

        select {
          width: 100%;
          padding: 5px;
          border-radius: 5px;
          border: 1px solid #ccc;
        }

        table {
          width: 100%;
          border-collapse: collapse;
        }

        table, th, td {
          border: 1px solid #aaa;
        }

        th, td {
          padding: 5px;
          text-align: center;
          font-size: 0.9em;
        }

        th {
          background: #f0f0f0;
        }

        #autoRunBtn.running {
          background: #d32f2f;
        }
    </style>
</head>
<body>

<h1>üèó Colony Builder</h1>

<!-- ========== Game Info ========== -->
<div class="panel">
    <h2>Game Info</h2>
    <p><b>Turn:</b> <span id="turnLabel">0</span></p>
    <p><b>Status:</b> <span id="statusLabel"></span></p>
    <p><b>Resources:</b> <span id="resourcesLabel"></span></p>
    <button id="nextTurnBtn">Next Turn</button>
    <button id="autoRunBtn">Start Auto Run</button>
</div>

<div class="grid">

    <!-- ========== Colonist Management ========== -->
    <div class="panel">
        <h2>Colonists</h2>
        <select id="colonistDropdown"></select>

        <div id="colonistStats">
            <p><b>Age:</b> <span id="ageLabel"></span></p>
            <p><b>Sex:</b> <span id="sexLabel"></span></p>
            <p><b>Health:</b> <span id="healthLabel"></span></p>
            <p><b>Energy:</b> <span id="energyLabel"></span></p>
            <p><b>Hunger:</b> <span id="hungerLabel"></span></p>
            <p><b>Occupation:</b> <span id="occupationLabel"></span></p>
            <p><b>Profession:</b> <span id="professionLabel"></span></p>
            <p><b>Building:</b> <span id="buildingLabel"></span></p>
            <p><b>Status:</b> <span id="colstatusLabel"></span></p>
            <p><b>Pregnant:</b> <span id="pregnantLabel"></span></p>
            <p><b>Children:</b> <span id="childrenLabel"></span></p>
        </div>
        <button id="feedBtn">Feed +1 Food</button>
        <button id="reduceFeedBtn">Deallocate -1 Food</button>
    </div>

    <!-- ========== Relationship Table ========== -->
    <div class="panel">
        <h2>Relationships</h2>
        <table id="relationshipTable">
            <thead>
            <tr>
                <th>Colonist</th>
                <th>Romantic</th>
                <th>Friendship</th>
                <th>Family</th>
                <th>Proximity</th>
                <th>Admiration</th>
                <th>Sexual</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<script>
    let autoRunning = false;
    let autoInterval;

    async function getJSON(url) {
      const res = await fetch(url);
      return await res.json();
    }

    async function getText(url) {
      const res = await fetch(url);
      return await res.text();
    }

    async function refreshGame() {
      document.getElementById('turnLabel').textContent = await getText('/api/game/turn');
      document.getElementById('statusLabel').textContent = await getText('/api/game/status');
      document.getElementById('resourcesLabel').textContent = await getText('/api/game/resources');
      await loadColonists();
    }

    async function loadColonists() {
      const colonists = await getJSON('/api/game/colonists');
      const dropdown = document.getElementById('colonistDropdown');
      dropdown.innerHTML = '';
      colonists.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.name;
        opt.textContent = `${c.name} (Age: ${c.age})`;
        dropdown.appendChild(opt);
      });
      updateColonistStats();
    }

    async function updateColonistStats() {
      const name = document.getElementById('colonistDropdown').value;
      if (!name) return;
      const colonist = await getJSON(`/api/game/colonist/${name}`);

      document.getElementById('ageLabel').textContent = colonist.age;
      document.getElementById('occupationLabel').textContent = colonist.occupation || 'Unassigned';
      document.getElementById('energyLabel').textContent = colonist.energy;
      document.getElementById('hpLabel').textContent = colonist.health;
      document.getElementById('colonistStatus').textContent = colonist.status || '';

      // Update relationships
      updateRelationshipTable(colonist.relationships || []);
    }
    async function loadColonistDetails(name) {
      const c = await fetch(`/api/game/colonist/${name}`).then(r => r.json());
      document.getElementById('ageLabel').textContent = c.age;
      document.getElementById('sexLabel').textContent = c.sex;
      document.getElementById('healthLabel').textContent = c.health;
      document.getElementById('energyLabel').textContent = c.energy;
      document.getElementById('hungerLabel').textContent = c.hunger;
      document.getElementById('occupationLabel').textContent = c.occupation;
      document.getElementById('professionLabel').textContent = c.profession;
      document.getElementById('buildingLabel').textContent = c.building;
      document.getElementById('colstatusLabel').textContent = c.status;
      document.getElementById('pregnantLabel').textContent = c.pregnant ? "Yes" : "No";
      document.getElementById('childrenLabel').textContent = c.childrenCount;
    }


    async function updateRelationshipTable(relationships) {
      const tbody = document.getElementById('relationshipTable').querySelector('tbody');
      tbody.innerHTML = '';
      relationships.forEach(r => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${r.otherName}</td>
          <td>${r.romantic}</td>
          <td>${r.friendship}</td>
          <td>${r.family}</td>
          <td>${r.proximity}</td>
        `;
        tbody.appendChild(row);
      });
    }

    async function feedColonist(delta = 1) {
      const name = document.getElementById('colonistDropdown').value;
      await fetch(`/api/game/feed/${name}?delta=${delta}`, { method: 'POST' });
      refreshGame();
    }

    async function nextTurn() {
      await fetch('/api/game/nextTurn', { method: 'POST' });
      refreshGame();
    }

    function toggleAutoRun() {
      const btn = document.getElementById('autoRunBtn');
      if (autoRunning) {
        clearInterval(autoInterval);
        autoRunning = false;
        btn.textContent = 'Start Auto Run';
        btn.classList.remove('running');
      } else {
        autoRunning = true;
        btn.textContent = 'Stop Auto Run';
        btn.classList.add('running');
        autoInterval = setInterval(nextTurn, 1000);
      }
    }

    document.getElementById('nextTurnBtn').onclick = nextTurn;
    document.getElementById('feedBtn').onclick = () => feedColonist(1);
    document.getElementById('reduceFeedBtn').onclick = () => feedColonist(-1);
    document.getElementById('colonistDropdown').onchange = updateColonistStats;
    document.getElementById('autoRunBtn').onclick = toggleAutoRun;
    document.getElementById('colonistDropdown').addEventListener('change', e => {loadColonistDetails(e.target.value);});



    refreshGame();
</script>

</body>
</html>


